<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPM ‚Ä¢ Diagn√≥stico Estrat√©gico</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #FF2448; --accent: #00C1FF; --whatsapp: #25D366; --fuego: #ff5e37; --agua: #37b3ff; --tierra: #7ad65d; --aire: #dfe6e9; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: white; line-height: 1.6; }
        .container { width: 95%; max-width: 500px; margin: auto; padding: 20px; }
        .card { background: var(--card); border-radius: 24px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.05); margin-bottom: 20px; }
        h1 { font-size: 1.7rem; font-weight: 900; text-align: center; margin-bottom: 5px; }
        .btn { width: 100%; padding: 18px; border-radius: 14px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; color: inherit; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-whatsapp { background: var(--whatsapp); color: white; font-size: 1.1rem; }
        .btn-outline { background: rgba(255,255,255,0.05); color: #94a3b8; }
        .hidden { display: none; }
        .tag { padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .fuego { background: var(--fuego); color: white; } .agua { background: var(--agua); color: white; } .tierra { background: var(--tierra); color: white; } .aire { background: var(--aire); color: black; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { height: 10px; background: #334155; border-radius: 5px; }
        input[type=range]::-webkit-slider-thumb { height: 26px; width: 26px; border-radius: 50%; background: var(--accent); -webkit-appearance: none; margin-top: -8px; }
        .val-display { font-size: 3.5rem; font-weight: 900; color: var(--accent); text-align: center; margin: 10px 0; }
        .logo-img { width: 90px; height: 90px; border-radius: 50%; margin: 0 auto 15px; display: block; border: 2px solid var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <div id="screen-home" class="card">
        <img src="logo.png" alt="MPM" class="logo-img" onerror="this.style.display='none'">
        <h1>Preemptive Movement</h1>
        <p style="text-align:center; color: #94a3b8;">Sistema de diagn√≥stico MPM. Identifica patrones invisibles y antic√≠pate.</p>
        <button class="btn btn-primary" onclick="showScreen('screen-menu')">INICIAR EVALUACI√ìN</button>
    </div>

    <div id="screen-menu" class="hidden">
        <div class="card">
            <h2 style="margin-top:0">Selecciona M√≥dulo</h2>
            <div id="menu-list" style="display: grid; gap: 8px;"></div>
        </div>
    </div>

    <div id="screen-test" class="hidden">
        <div class="card">
            <div id="test-progress" style="color:var(--accent); font-weight:bold; margin-bottom:10px;"></div>
            <h3 id="question-text" style="min-height: 50px;">-</h3>
            <div class="val-display" id="display-value">5</div>
            <input type="range" id="main-slider" min="1" max="10" step="1" oninput="updateUIValue()">
            <div style="display:flex; gap:10px; margin-top:30px;">
                <button class="btn btn-outline" style="flex:1" onclick="prevQ()">Atr√°s</button>
                <button class="btn btn-primary" style="flex:2" onclick="nextQ()">Siguiente</button>
            </div>
        </div>
    </div>

    <div id="screen-results" class="hidden">
        <div class="card">
            <h1 style="color: var(--accent);">Resultados MPM</h1>
            <canvas id="mpmChart" style="margin: 20px 0;"></canvas>
            
            <div id="analysis-box" style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 15px; border-left: 4px solid var(--primary);">
                <div id="logic-text"></div>
            </div>

            <div style="margin-top: 25px;">
                <p style="text-align:center; font-weight:bold; color: var(--accent);">Para obtener el protocolo de acci√≥n completo:</p>
                <input type="text" id="userName" placeholder="Tu nombre" style="width:100%; padding:15px; border-radius:10px; border:none; margin-bottom:10px; background: #0f172a; color:white; box-sizing: border-box;">
                <button class="btn btn-whatsapp" onclick="sendWhatsApp()">SOLICITAR AN√ÅLISIS EXPERTO</button>
            </div>
            <button class="btn btn-outline" onclick="location.reload()">REINICIAR TEST</button>
        </div>
    </div>
</div>

<script>
const testsData = {
    colores: { n:"üé® Colores", q:["Rojo","Azul","Verde","Amarillo","Negro","Blanco","Morado","Naranja","Rosa","Gris","Turquesa","Marr√≥n","Dorado","Plateado","Beige","Fucsia"]},
    ciudades: { n:"üåÜ Ciudades", q:["Tokio","Par√≠s","Nueva York","Roma","Londres","S√≠dney","√Åmsterdam","Se√∫l","Barcelona","Los √Ångeles","Dub√°i","Berl√≠n","Buenos Aires","Toronto","El Cairo","Madrid"]},
    autos: { n:"üöó Autom√≥viles", q:["Ferrari","Toyota","Mercedes","Audi","Tesla","Ford","BMW","Chevrolet","Lamborghini","Honda","Porsche","Hyundai","Range Rover","Volkswagen","Peugeot","Citro√´n"]},
    alimentos: { n:"üçΩ Alimentos", q:["Chocolate","Manzana","Caf√©","Pan","Carne","Pasta","Arroz","Queso","Pollo","Miel","Nueces","Salm√≥n","Fresas","Aguacate","Huevos","Yogur"]},
    profesiones: { n:"üíº Profesiones", q:["M√©dico","Artista","Ingeniero","Abogado","Maestro","Programador","Empresario","Psic√≥logo","Chef","Polic√≠a","Arquitecto","Deportista","Cient√≠fico","Actor","Piloto","Escritor"]},
    animales: { n:"ü¶Å Animales", q:["Le√≥n","Lobo","√Åguila","Delf√≠n","Tigre","Serpiente","Perro","Gato","Caballo","B√∫ho","Tibur√≥n","Oso","Cuervo","Conejo","Toro","Halc√≥n"]},
    estaciones: { n:"üçÅ Estaciones", q:["Primavera","Verano","Oto√±o","Invierno","Amanecer","Atardecer","Mediod√≠a","Medianoche","Clima tropical","Clima √°rtico","Clima templado","Clima des√©rtico","Ambiente h√∫medo","Ambiente seco","Zona monta√±osa","Zona costera"]},
    instrumentos: { n:"üéµ Instrumentos", q:["Piano","Guitarra","Viol√≠n","Flauta","Bater√≠a","Saxof√≥n","Arpa","Trompeta","Bajo","Acorde√≥n","Ukelele","Timbal","DJ Mixer","Voz humana","√ìrgano","Cello"]},
    paises: { n:"üåç Pa√≠ses", q:["Jap√≥n","Estados Unidos","Francia","Espa√±a","Alemania","Italia","M√©xico","Brasil","Argentina","Canad√°","Australia","Egipto","India","China","Rusia","Grecia"]},
    metales: { n:"üî© Metales", q:["Oro","Plata","Bronce","Cobre","Hierro","Plomo","Titanio","Mercurio","Acero","Lat√≥n","Platino","Wolframio","N√≠quel","Aluminio","Cobalto","Iridio"]},
    paisajes: { n:"üèû Paisajes", q:["Mar","Bosque","Monta√±a","Desierto","Cascada","Pradera","Jungla","Cueva","Glaciar","Ca√±√≥n","Volc√°n","Llanura","Isla","Tundra","Sabana","Arrecife"]},
    arquitectura: { n:"üèõ Arquitectura", q:["Minimalista","Barroco","G√≥tico","Rom√°nico","Brutalista","Art Deco","Cl√°sico","Futurista","Industrial","Neocl√°sico","Org√°nico","Colonial","High-Tech","Renacentista","Moderno","Posmoderno"]},
    sabores: { n:"üçØ Sabores", q:["Dulce","√Åcido","Amargo","Salado","Umami","Picante","Agridulce","Herbal","Tostado","Fresco","Cremoso","Fermentado","Marino","Ahumado","Frutal","Especiado"]},
    tecnologias: { n:"üì≤ Tecnolog√≠as", q:["IA","Rob√≥tica","Web3","Cripto","Medicina","Bioingenier√≠a","Big Data","Nano","VR","Sat√©lites","EVs","IoT","Cloud","Fusi√≥n","Drones","Quantum"]},
    epocas: { n:"‚åõ √âpocas", q:["Grecia","Roma","Edad Media","Renacimiento","Ilustraci√≥n","Rev Industrial","A√±os 20","A√±os 50","A√±os 80","Actualidad","Futuro Cercano","Futuro Lejano","Barroco","Romanticismo","Modernismo","Transhumanismo"]},
    arquetipos: { n:"üî± Arquetipos", q:["Drag√≥n","F√©nix","Unicornio","Kraken","Pegaso","Minotauro","Sirena","Grifo","Quimera","Anubis","Thor","Medusa","Zeus","Hades","Ra","Od√≠n"]}
};

const tablaMPM = {
    "1111":[1,"fuego","ALTA ENERG√çA DIN√ÅMICA"],"0000":[2,"fuego","BLOQUEO POR CONTENCI√ìN"],"0110":[3,"agua","EXPANSI√ìN EMOCIONAL"],"1001":[4,"agua","INVOLUCI√ìN AFECTIVA"],"1000":[5,"aire","ENFOQUE ESTRAT√âGICO"],"0001":[6,"tierra","DESESTRUCTURACI√ìN"],"1110":[7,"tierra","SOLIDEZ OPERATIVA"],"0111":[8,"aire","DISPERSI√ìN MENTAL"]
};

let currentModule = ''; let currentIdx = 0; let scores = []; let lastResult = {};

function showScreen(id) {
    document.querySelectorAll('[id^="screen-"]').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}

function init() {
    const list = document.getElementById('menu-list');
    Object.keys(testsData).forEach(key => {
        const b = document.createElement('button');
        b.className = 'btn btn-outline';
        b.innerText = testsData[key].n;
        b.onclick = () => { currentModule = key; currentIdx = 0; scores = Array(16).fill(5); loadQuestion(); showScreen('screen-test'); };
        list.appendChild(b);
    });
}

function loadQuestion() {
    document.getElementById('test-progress').innerText = `${testsData[currentModule].n} | ${currentIdx+1}/16`;
    document.getElementById('question-text').innerText = testsData[currentModule].q[currentIdx];
    document.getElementById('display-value').innerText = scores[currentIdx];
    document.getElementById('main-slider').value = scores[currentIdx];
}

function updateUIValue() {
    scores[currentIdx] = parseInt(document.getElementById('main-slider').value);
    document.getElementById('display-value').innerText = scores[currentIdx];
}

function nextQ() {
    if(currentIdx < 15) { currentIdx++; loadQuestion(); }
    else { generateLocalAnalysis(); }
}

function prevQ() { if(currentIdx > 0) { currentIdx--; loadQuestion(); } }

function generateLocalAnalysis() {
    showScreen('screen-results');
    const getB = (s) => {
        const bits = scores.slice(s, s+4).map(v => v >= 5 ? "1" : "0").join("");
        const d = tablaMPM[bits] || [9, "aire", "ESTADO NEUTRO"];
        return { id:d[0], elem:d[1], msg:d[2] };
    };

    const s = getB(0); const m = getB(4); const t = getB(8); const r = getB(12);
    
    // L√≥gica de Diferenciaci√≥n de Texto (El Gancho)
    let diag = "";
    if (s.elem === 'fuego' && r.elem === 'agua') diag = "Tu impulso inicial (Fuego) se est√° 'extinguiendo' al llegar al resultado. Hay una fuga de energ√≠a en la fase de transformaci√≥n.";
    else if (s.elem === 'tierra' && r.elem === 'aire') diag = "Tienes una base s√≥lida pero el resultado se dispersa. Falta cohesi√≥n en el movimiento t√°ctico.";
    else if (s.elem === r.elem) diag = "Patr√≥n de redundancia detectado. Tu sistema replica la situaci√≥n inicial en el resultado sin evolucionar. Estancamiento c√≠clico.";
    else if (s.elem === 'agua' && r.elem === 'fuego') diag = "Conversi√≥n de alta intensidad. Est√°s transformando pasividad en acci√≥n, pero el coste energ√©tico es cr√≠tico.";
    else diag = "Transici√≥n compleja detectada entre " + s.elem + " y " + r.elem + ". La arquitectura de tu movimiento muestra asimetr√≠as t√°cticas.";

    lastResult = { s, m, t, r };
    
    document.getElementById('logic-text').innerHTML = `
        <p><strong>ESTADO INICIAL:</strong> <span class="tag ${s.elem}">${s.elem}</span></p>
        <p><strong>TENDENCIA FINAL:</strong> <span class="tag ${r.elem}">${r.elem}</span></p>
        <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0;">
        <p style="color: #cbd5e1; font-size: 1.05rem;">${diag}</p>
        <p style="margin-top:10px; color: var(--accent); font-weight:bold;">Recomendaci√≥n: Evaluar fase de MOVIMIENTO (M:${m.id}) y TRANSFORMACI√ìN (T:${t.id}).</p>
    `;
    renderChart(scores);
}

function renderChart(sc) {
    const ctx = document.getElementById('mpmChart').getContext('2d');
    const data = [sc.slice(0,4).reduce((a,b)=>a+b)/4, sc.slice(4,8).reduce((a,b)=>a+b)/4, sc.slice(8,12).reduce((a,b)=>a+b)/4, sc.slice(12,16).reduce((a,b)=>a+b)/4];
    new Chart(ctx, { type: 'radar', data: { labels: ['S', 'M', 'T', 'R'], datasets: [{ data, backgroundColor: 'rgba(0,193,255,0.2)', borderColor: '#00C1FF', pointBackgroundColor: '#FF2448', borderWidth: 3 }] }, options: { scales: { r: { min:0, max:10, ticks: { display:false }, grid: { color: 'rgba(255,255,255,0.1)' } } }, plugins: { legend: { display:false } } } });
}

function sendWhatsApp() {
    const name = document.getElementById('userName').value || "Interesado";
    const msg = `Hola, soy ${name}. He completado el test MPM en el m√≥dulo ${currentModule}. Mis c√≥digos son S:${lastResult.s.id}, M:${lastResult.m.id}, T:${lastResult.t.id}, R:${lastResult.r.id}. Solicito mi informe detallado.`;
    window.open(`https://wa.me/34672680535?text=${encodeURIComponent(msg)}`);
}

init();
</script>
</body>
</html>
